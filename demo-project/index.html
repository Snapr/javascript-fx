
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>FX Demo</title>

    <link rel="stylesheet" href="styles/fx-ui-base.css" type="text/css" charset="utf-8">

    <script type='text/javascript' src='../libs/jquery-1.8.2.js'></script>
    <script type='text/javascript' src='../libs/jpegmeta.js'></script>
    <script type='text/javascript' src='../filters.js'></script>

    <script>


    var filter_pack = '../filter-packs/booktrack-demo/',
        sticker_pack = '../sticker-packs/tuxedo-kittie/';


    $(function(){
        var img = $('.x-preview-image'),
            orig = img.clone().hide().appendTo(document.body);
            src = orig.attr('src'),

            image = new SnaprFX({
                url: src,
                element: img,
                width: 400,
                height: Math.floor((40 / 56) * 750),
                filter_pack: filter_pack,
                sticker_pack: sticker_pack,
                text: {
                }
            });

        image.load_filter_pack.done(function(pack){
            $('.x-effects').append(
                $('<a> <img src="'+pack.base_path+'original-thumb@2x.png">Original </a>')
                .click(function(){
                    $('.x-current-filter').removeClass('x-current-filter');
                    $(this).addClass('x-current-filter');
                    image.revert();
                })
            );
            $.each(pack.filter_pack.filters, function(i, filter){
                $('.x-effects').append(
                    $('<a> <img src="'+pack.base_path+'/filters/'+filter.slug+'/thumb@2x.png">'+filter.name+' </a>')
                    .click(function(){
                        if(image.current_filter == filter.slug){
                            return;
                        }
                        $(document.body).addClass('x-processing');
                        image.apply_filter({filter: filter.slug});
                        $('.x-current-filter').removeClass('x-current-filter');
                        $(this).addClass('x-current-filter');
                        image.deferred.done(function(){
                            $(document.body).removeClass('x-processing');
                        });
                    })
                );
            });
        });

        $('.x-render-full').click(function(){
            var output = new SnaprFX({
                url: src,
                element: $('.x-output-area img'),
                width: 560,
                height: 750
            });
            output.deferred.done(function(){
                output.apply_filter({filter: image.current_filter});
            });
        });

        $('.kitten').click(function(){
            $(document.body).addClass('x-processing');
            src = $(this).attr('src');
            image.set_url(src).done(function(){
                image.deferred.done(function(){
                    $(document.body).removeClass('x-processing');
                });
            });
            $('.x-current-image').removeClass('x-current-image');
            $(this).addClass('x-current-image');
        });

        var active_slug;
        $('.fx-text').live('activate', function(e, data){

            active_slug = data.slug;

            $('.x-text-active-layer-name').text(data.name);

            var font = $(this).find('.fx-text-inner').css('font-family').split(', ')[0];
            var $font = $('.font');
            $font.val(font);
            // if the select hasn't change to the right font then we need to add it
            if($font.val() != font){
                $font.append($('<option value="'+font+'">'+font+'</option>'));
                $font.val(font);
            }

            $('#x-text-bold').attr('checked', $(this).find('.fx-text-inner').css('font-weight') == 'bold');
            $('#x-text-italic').attr('checked', $(this).find('.fx-text-inner').css('font-style') == 'italic');

            $('.font-size').val(Math.round(data.text.style.fontSize));
            $('[name=x-text-align][value='+data.text.style.textAlign+']').attr('checked', true);

            $('.other-color').val(data.text.style.fillStyle);
            var checked = $('[name=x-text-color][value='+data.text.style.fillStyle+']').attr('checked', true);
            if(!checked.length){
                $('[name=x-text-color][value=other]').attr('checked', true);
            }

        });
        $('.fx-text').live('deactivate', function(e, data){
            $(document.body).addClass('x-processing');
            image.set_text_style(active_slug, {}).done(function(){
                image.deferred.done(function(){
                    $(document.body).removeClass('x-processing');
                });
            });

            active_slug = null;
            $('.x-text-active-layer-name').text('No layer selected');
        });

        $('.x-increase-text-size').click(function(event){
            event.preventDefault();
            $('.font-size').val(parseInt($('.font-size').val(), 10)+1);
            $('.x-change-font').trigger('change');
        });
        $('.x-decrease-text-size').click(function(event){
            event.preventDefault();
            $('.font-size').val(parseInt($('.font-size').val(), 10)-1);
            $('.x-change-font').trigger('change');
        });


        $('.x-change-font').on('change', function(){
            var overlay = $('.fx-text-active .fx-text-inner');

            overlay.css({
                'font-family': $('.font').val(),
                'font-size': $('.font-size').val()+'px',
                'font-weight': $('#x-text-bold').attr('checked') ? 'bold' : 'normal',
                'font-style': $('#x-text-italic').attr('checked') ? 'italic' : 'normal',
                'color': $('.other-color').val(),
                'text-align': $('[name=x-text-align]:checked').val()
            });
        });

        $('.x-change-color').on('change', function(){
            $('.other-color').val($('[name=x-text-color]:checked').val()).trigger('change');
        });

        $('.fx-render-layer').live('click', function(event){
            event.preventDefault();

            var text = $('.fx-text-active .fx-text-inner');

            image.options.text[active_slug] = text.html()
                .replace(/<br\/?>/g, '\n')  // <br> to newline
                .replace(/&nbsp;/g, ' ')  // non-breking space to normal space
                .replace(/<.*?>/g, '');  // strip html tags

            text.html(image.options.text[active_slug].replace(/\n/g, '<br>'));

            var data = {
                font: text.css('font'),
                textAlign: $('[name=x-text-align]:checked').val(),
                fillStyle: $('.other-color').val()
            };

            $(document.body).addClass('x-processing');
            image.set_text_style(active_slug, data).done(function(){
                image.deferred.done(function(){
                    $('.fx-text-active')
                        .removeClass('fx-text-active')
                        .css({opacity: 0, 'z-index': false});
                    $(document.body).removeClass('x-processing');
                });
            });

        });

        $('.fx-delete-layer').live('click', function(event){
            $(document.body).addClass('x-processing');

            $('.fx-text-active')
                .removeClass('fx-text-active')
                .css({opacity: 0, 'z-index': false});

            image.remove_text(active_slug).done(function(){
                image.deferred.done(function(){
                    $(document.body).removeClass('x-processing');
                });
            });
        });

    });
    </script>


</head>
<body>


    <div class="x-demo-area ">
        <div class="x-preview">
            <h1>Preview:</h1>
            <div class="x-preview-image-area">
                <div class="x-activity-indicator">
                    <div class="x-spinner"></div>
                    Rendering..
                </div>
                <img class="x-preview-image" src="images/a.jpg">
            </div>
        </div>

        <div class="x-settings">
            <h1>Settings:</h1>
            <ul>
                <li>
                    <h2>Source:</h2>
                    <div class="x-source">
                        <img class="kitten" src="images/a.jpg" style="width:56px;height:75px">
                        <img class="kitten" src="images/b.jpg" style="width:56px;height:75px">
                        <img class="kitten" src="images/c.jpg" style="width:56px;height:75px">
                    </div>
                </li>

                <li>
                    <h2>Effects:</h2>
                    <div class="x-effects">
                    </div>
                </li>

                <li>
                    <h2>Text:</h2>

                    <div class="x-text">
                        <h3>Selected: <span class="x-text-active-layer-name"></span>
                            <form>
                                <fieldset>
                                    <label>Font:</label>
                                    <select class="font x-change-font">
                                        <option value="Verdana">Verdana</option>
                                        <option value="Helvetica">Helvetica</option>
                                        <option value="CrimsonBold">Crimson Bold</option>
                                    </select>

                                    <label>Size:</label>
                                    <button class="x-increase-text-size">+</button>
                                    <input type="text" class="font-size x-change-font" value="10">
                                    <button class="x-decrease-text-size">-</button>

                                </fieldset>
                                 <fieldset>

                                        <label>Style:</label>
                                        <input type="checkbox" id="x-text-bold" value="bold" name="x-text-bold" class="x-change-font"/>
                                        <label for="x-text-bold">Bold</label>
                                        <input type="checkbox" id="x-text-italic" value="italic" name="x-text-italic" class="x-change-font"/>
                                        <label for="x-text-italic">Italic</label>
                                    </fieldset>

                                <fieldset>

                                    <label>Align:</label>
                                    <input type="radio" id="x-align-left" value="left" name="x-text-align" class="x-change-font"/>
                                    <label for="x-align-left">left</label>

                                    <input type="radio" id="x-align-center" value="center" name="x-text-align" class="x-change-font"/>
                                    <label for="x-align-center">center</label>

                                    <input type="radio" id="x-align-right" value="right" name="x-text-align" class="x-change-font"/>
                                    <label for="x-align-right">right</label>

                                </fieldset>

                                <fieldset>

                                    <label>Color:</label>
                                    <input type="radio" id="x-color-red" value="#d63e27" name="x-text-color" class="x-change-color"/>
                                    <label for="x-color-red">Red</label>

                                    <input type="radio" id="x-color-yellow" value="#f6f442" name="x-text-color" class="x-change-color"/>
                                    <label for="x-color-yellow">Yellow</label>

                                    <input type="radio" id="x-color-black" value="#000" name="x-text-color" class="x-change-color"/>
                                    <label for="x-color-black">Black</label>

                                    <input type="radio" id="x-color-other" value="other" name="x-text-color"/>
                                    <label for="x-color-other">Other</label>

                                    <input class="other-color x-change-font">

                                </fieldset>
                                <!-- <fieldset>
                                                                  <button id="x-add-textfield">Add a textfield</button>
                                                              </fieldset> -->
                            </form>

                        </div>
                    </li>

                    <li>
                        <h2>Render:</h2>

                        <div class="x-render">
                            <button class="x-render-full">Render Full Size</button>
                        </div>
                    </li>

                </ul>

            </div>

            <div class="x-output">
                <h1>Output:</h1>
                <div class="x-output-area">
                    <img>
                </div>
            </div>

        </body>
        </html>

