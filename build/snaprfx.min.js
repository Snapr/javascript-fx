var JpegMeta=function(){if(this.JpegMeta)return this.JpegMeta;var b=this.JpegMeta={};b.parseNum=function(c,a,b,f){var h,g;c=">"===c;void 0===b&&(b=0);void 0===f&&(f=a.length-b);for(c?h=b:h=b+f-1;c?h<b+f:h>=b;c?h++:h--)g<<=8,g+=a.charCodeAt(h);return g};b.parseSnum=function(c,a,b,f){var h,g,e;c=">"===c;void 0===b&&(b=0);void 0===f&&(f=a.length-b);for(c?h=b:h=b+f-1;c?h<b+f:h>=b;c?h++:h--)void 0===e&&(e=128===(a.charCodeAt(h)&128)),g<<=8,g+=e?~a.charCodeAt(h)&255:a.charCodeAt(h);e&&(g=-1*(g+1));return g};
b.Rational=function(c,a){this.num=c;this.den=a||1;return this};b.Rational.prototype.toString=function(){return 0===this.num||1===this.den?""+this.num:1===this.num?this.num+" / "+this.den:this.num/this.den};b.Rational.prototype.asFloat=function(){return this.num/this.den};b.MetaGroup=function(c,a){this.fieldName=c;this.description=a;this.metaProps={};return this};b.MetaGroup.prototype._addProperty=function(c,a,d){c=new b.MetaProp(c,a,d);this[c.fieldName]=c;this.metaProps[c.fieldName]=c};b.MetaGroup.prototype.toString=
function(){return"[MetaGroup "+this.description+"]"};b.MetaProp=function(c,a,b){this.fieldName=c;this.description=a;this.value=b;return this};b.MetaProp.prototype.toString=function(){return""+this.value};this.JpegMeta.JpegFile=function(c,a){var d=this._SOS;this.metaGroups={};this._binary_data=c;this.filename=a;var f=0,h=0,g,e;if(this._binary_data.slice(0,2)!==this._SOI_MARKER)throw Error("Doesn't look like a JPEG file. First two bytes are "+this._binary_data.charCodeAt(0)+","+this._binary_data.charCodeAt(1)+
".");for(f+=2;f<this._binary_data.length;){g=this._binary_data.charCodeAt(f++);e=this._binary_data.charCodeAt(f++);h=f;if(g!=this._DELIM)break;if(e===d)break;g=b.parseNum(">",this._binary_data,f,2);for(f+=g;f<this._binary_data.length;)if(g=this._binary_data.charCodeAt(f++),g==this._DELIM&&(g=this._binary_data.charCodeAt(f++),0!=g)){f-=2;break}if(g=this._markers[e]?this._markers[e][1]:void 0)this[g](e,h+2)}if(void 0===this.general)throw Error("Invalid JPEG file.");return this};this.JpegMeta.JpegFile.prototype.toString=
function(){return"[JpegFile "+this.filename+" "+this.general.type+" "+this.general.pixelWidth+"x"+this.general.pixelHeight+" Depth: "+this.general.depth+"]"};this.JpegMeta.JpegFile.prototype._SOI_MARKER="\u00ff\u00d8";this.JpegMeta.JpegFile.prototype._DELIM=255;this.JpegMeta.JpegFile.prototype._EOI=217;this.JpegMeta.JpegFile.prototype._SOS=218;this.JpegMeta.JpegFile.prototype._sofHandler=function(c,a){if(void 0!==this.general)throw Error("Unexpected multiple-frame image");this._addMetaGroup("general",
"General");this.general._addProperty("depth","Depth",b.parseNum(">",this._binary_data,a,1));this.general._addProperty("pixelHeight","Pixel Height",b.parseNum(">",this._binary_data,a+1,2));this.general._addProperty("pixelWidth","Pixel Width",b.parseNum(">",this._binary_data,a+3,2));this.general._addProperty("type","Type",this._markers[c][2])};this.JpegMeta.JpegFile.prototype._JFIF_IDENT="JFIF\x00";this.JpegMeta.JpegFile.prototype._JFXX_IDENT="JFXX\x00";this.JpegMeta.JpegFile.prototype._EXIF_IDENT=
"Exif\x00";this.JpegMeta.JpegFile.prototype._types={1:["BYTE",1],2:["ASCII",1],3:["SHORT",2],4:["LONG",4],5:["RATIONAL",8],6:["SBYTE",1],7:["UNDEFINED",1],8:["SSHORT",2],9:["SLONG",4],10:["SRATIONAL",8],11:["FLOAT",4],12:["DOUBLE",8]};this.JpegMeta.JpegFile.prototype._tifftags={256:["Image width","ImageWidth"],257:["Image height","ImageLength"],258:["Number of bits per component","BitsPerSample"],259:["Compression scheme","Compression",{1:"uncompressed",6:"JPEG compression"}],262:["Pixel composition",
"PhotmetricInerpretation",{2:"RGB",6:"YCbCr"}],274:["Orientation of image","Orientation",{1:"Normal",2:"Reverse?",3:"Upside-down",4:"Upside-down Reverse",5:"90 degree CW",6:"90 degree CW reverse",7:"90 degree CCW",8:"90 degree CCW reverse"}],277:["Number of components","SamplesPerPixel"],284:["Image data arrangement","PlanarConfiguration",{1:"chunky format",2:"planar format"}],530:["Subsampling ratio of Y to C","YCbCrSubSampling"],531:["Y and C positioning","YCbCrPositioning",{1:"centered",2:"co-sited"}],
282:["X Resolution","XResolution"],283:["Y Resolution","YResolution"],296:["Resolution Unit","ResolutionUnit",{2:"inches",3:"centimeters"}],273:["Image data location","StripOffsets"],278:["Number of rows per strip","RowsPerStrip"],279:["Bytes per compressed strip","StripByteCounts"],513:["Offset to JPEG SOI","JPEGInterchangeFormat"],514:["Bytes of JPEG Data","JPEGInterchangeFormatLength"],301:["Transfer function","TransferFunction"],318:["White point chromaticity","WhitePoint"],319:["Chromaticities of primaries",
"PrimaryChromaticities"],529:["Color space transformation matrix coefficients","YCbCrCoefficients"],532:["Pair of black and white reference values","ReferenceBlackWhite"],306:["Date and time","DateTime"],270:["Image title","ImageDescription"],271:["Make","Make"],272:["Model","Model"],305:["Software","Software"],315:["Person who created the image","Artist"],316:["Host Computer","HostComputer"],33432:["Copyright holder","Copyright"],34665:["Exif tag","ExifIfdPointer"],34853:["GPS tag","GPSInfoIfdPointer"]};
this.JpegMeta.JpegFile.prototype._exiftags={36864:["Exif Version","ExifVersion"],40960:["FlashPix Version","FlashpixVersion"],40961:["Color Space","ColorSpace"],37121:["Meaning of each component","ComponentsConfiguration"],37122:["Compressed Bits Per Pixel","CompressedBitsPerPixel"],40962:["Pixel X Dimension","PixelXDimension"],40963:["Pixel Y Dimension","PixelYDimension"],37500:["Manufacturer notes","MakerNote"],37510:["User comments","UserComment"],40964:["Related audio file","RelatedSoundFile"],
36867:["Date Time Original","DateTimeOriginal"],36868:["Date Time Digitized","DateTimeDigitized"],37520:["DateTime subseconds","SubSecTime"],37521:["DateTimeOriginal subseconds","SubSecTimeOriginal"],37522:["DateTimeDigitized subseconds","SubSecTimeDigitized"],33434:["Exposure time","ExposureTime"],33437:["FNumber","FNumber"],34850:["Exposure program","ExposureProgram"],34852:["Spectral sensitivity","SpectralSensitivity"],34855:["ISO Speed Ratings","ISOSpeedRatings"],34856:["Optoelectric coefficient",
"OECF"],37377:["Shutter Speed","ShutterSpeedValue"],37378:["Aperture Value","ApertureValue"],37379:["Brightness","BrightnessValue"],37380:["Exposure Bias Value","ExposureBiasValue"],37381:["Max Aperture Value","MaxApertureValue"],37382:["Subject Distance","SubjectDistance"],37383:["Metering Mode","MeteringMode"],37384:["Light Source","LightSource"],37385:["Flash","Flash"],37386:["Focal Length","FocalLength"],37396:["Subject Area","SubjectArea"],41483:["Flash Energy","FlashEnergy"],41484:["Spatial Frequency Response",
"SpatialFrequencyResponse"],41486:["Focal Plane X Resolution","FocalPlaneXResolution"],41487:["Focal Plane Y Resolution","FocalPlaneYResolution"],41488:["Focal Plane Resolution Unit","FocalPlaneResolutionUnit"],41492:["Subject Location","SubjectLocation"],41493:["Exposure Index","ExposureIndex"],41495:["Sensing Method","SensingMethod"],41728:["File Source","FileSource"],41729:["Scene Type","SceneType"],41730:["CFA Pattern","CFAPattern"],41985:["Custom Rendered","CustomRendered"],41986:["Exposure Mode",
"Exposure Mode"],41987:["White Balance","WhiteBalance"],41988:["Digital Zoom Ratio","DigitalZoomRatio"],41990:["Scene Capture Type","SceneCaptureType"],41991:["Gain Control","GainControl"],41992:["Contrast","Contrast"],41993:["Saturation","Saturation"],41994:["Sharpness","Sharpness"],41995:["Device settings description","DeviceSettingDescription"],41996:["Subject distance range","SubjectDistanceRange"],42016:["Unique image ID","ImageUniqueID"],40965:["Interoperability tag","InteroperabilityIFDPointer"]};
this.JpegMeta.JpegFile.prototype._gpstags={"0":["GPS tag version","GPSVersionID"],1:["North or South Latitude","GPSLatitudeRef"],2:["Latitude","GPSLatitude"],3:["East or West Longitude","GPSLongitudeRef"],4:["Longitude","GPSLongitude"],5:["Altitude reference","GPSAltitudeRef"],6:["Altitude","GPSAltitude"],7:["GPS time (atomic clock)","GPSTimeStamp"],8:["GPS satellites usedd for measurement","GPSSatellites"],9:["GPS receiver status","GPSStatus"],10:["GPS mesaurement mode","GPSMeasureMode"],11:["Measurement precision",
"GPSDOP"],12:["Speed unit","GPSSpeedRef"],13:["Speed of GPS receiver","GPSSpeed"],14:["Reference for direction of movement","GPSTrackRef"],15:["Direction of movement","GPSTrack"],16:["Reference for direction of image","GPSImgDirectionRef"],17:["Direction of image","GPSImgDirection"],18:["Geodetic survey data used","GPSMapDatum"],19:["Reference for latitude of destination","GPSDestLatitudeRef"],20:["Latitude of destination","GPSDestLatitude"],21:["Reference for longitude of destination","GPSDestLongitudeRef"],
22:["Longitude of destination","GPSDestLongitude"],23:["Reference for bearing of destination","GPSDestBearingRef"],24:["Bearing of destination","GPSDestBearing"],25:["Reference for distance to destination","GPSDestDistanceRef"],26:["Distance to destination","GPSDestDistance"],27:["Name of GPS processing method","GPSProcessingMethod"],28:["Name of GPS area","GPSAreaInformation"],29:["GPS Date","GPSDateStamp"],30:["GPS differential correction","GPSDifferential"]};this.JpegMeta.JpegFile.prototype._markers=
{192:["SOF0","_sofHandler","Baseline DCT"],193:["SOF1","_sofHandler","Extended sequential DCT"],194:["SOF2","_sofHandler","Progressive DCT"],195:["SOF3","_sofHandler","Lossless (sequential)"],197:["SOF5","_sofHandler","Differential sequential DCT"],198:["SOF6","_sofHandler","Differential progressive DCT"],199:["SOF7","_sofHandler","Differential lossless (sequential)"],200:["JPG",null,"Reserved for JPEG extensions"],201:["SOF9","_sofHandler","Extended sequential DCT"],202:["SOF10","_sofHandler","Progressive DCT"],
203:["SOF11","_sofHandler","Lossless (sequential)"],205:["SOF13","_sofHandler","Differential sequential DCT"],206:["SOF14","_sofHandler","Differential progressive DCT"],207:["SOF15","_sofHandler","Differential lossless (sequential)"],196:["DHT",null,"Define Huffman table(s)"],204:["DAC",null,"Define arithmetic coding conditioning(s)"],208:["RST0",null,"Restart with modulo 8 count \u201c0\u201d"],209:["RST1",null,"Restart with modulo 8 count \u201c1\u201d"],210:["RST2",null,"Restart with modulo 8 count \u201c2\u201d"],
211:["RST3",null,"Restart with modulo 8 count \u201c3\u201d"],212:["RST4",null,"Restart with modulo 8 count \u201c4\u201d"],213:["RST5",null,"Restart with modulo 8 count \u201c5\u201d"],214:["RST6",null,"Restart with modulo 8 count \u201c6\u201d"],215:["RST7",null,"Restart with modulo 8 count \u201c7\u201d"],216:["SOI",null,"Start of image"],217:["EOI",null,"End of image"],218:["SOS",null,"Start of scan"],219:["DQT",null,"Define quantization table(s)"],220:["DNL",null,"Define number of lines"],221:["DRI",
null,"Define restart interval"],222:["DHP",null,"Define hierarchical progression"],223:["EXP",null,"Expand reference component(s)"],224:["APP0","_app0Handler","Reserved for application segments"],225:["APP1","_app1Handler"],226:["APP2",null],227:["APP3",null],228:["APP4",null],229:["APP5",null],230:["APP6",null],231:["APP7",null],232:["APP8",null],233:["APP9",null],234:["APP10",null],235:["APP11",null],236:["APP12",null],237:["APP13",null],238:["APP14",null],239:["APP15",null],240:["JPG0",null],241:["JPG1",
null],242:["JPG2",null],243:["JPG3",null],244:["JPG4",null],245:["JPG5",null],246:["JPG6",null],247:["JPG7",null],248:["JPG8",null],249:["JPG9",null],250:["JPG10",null],251:["JPG11",null],252:["JPG12",null],253:["JPG13",null],254:["COM",null],1:["JPG13",null]};this.JpegMeta.JpegFile.prototype._addMetaGroup=function(c,a){var d=new b.MetaGroup(c,a);this[d.fieldName]=d;return this.metaGroups[d.fieldName]=d};this.JpegMeta.JpegFile.prototype._parseIfd=function(c,a,d,f,h,g,e){var k=b.parseNum(c,a,d+f,2),
l,n,m,p,q,r,s,t,u;u=this._addMetaGroup(g,e);for(g=0;g<k;g++)if(l=d+f+2+12*g,e=b.parseNum(c,a,l,2),m=b.parseNum(c,a,l+2,2),p=b.parseNum(c,a,l+4,4),q=b.parseNum(c,a,l+8,4),void 0!==this._types[m]){n=this._types[m][0];m=this._types[m][1];q=4>=m*p?l+8:d+q;if("UNDEFINED"==n)r=a.slice(q,q+p);else if("ASCII"==n)r=a.slice(q,q+p),r=r.split("\x00")[0];else{r=[];for(l=0;l<p;l++,q+=m)("BYTE"==n||"SHORT"==n||"LONG"==n)&&r.push(b.parseNum(c,a,q,m)),("SBYTE"==n||"SSHORT"==n||"SLONG"==n)&&r.push(b.parseSnum(c,a,
q,m)),"RATIONAL"==n&&(s=b.parseNum(c,a,q,4),t=b.parseNum(c,a,q+4,4),r.push(new b.Rational(s,t))),"SRATIONAL"==n&&(s=b.parseSnum(c,a,q,4),t=b.parseSnum(c,a,q+4,4),r.push(new b.Rational(s,t))),r.push();1===p&&(r=r[0])}null!=h[e]&&u._addProperty(h[e][1],h[e][0],r)}};this.JpegMeta.JpegFile.prototype._jfifHandler=function(c,a){if(void 0!==this.jfif)throw Error("Multiple JFIF segments found");this._addMetaGroup("jfif","JFIF");this.jfif._addProperty("version_major","Version Major",this._binary_data.charCodeAt(a+
5));this.jfif._addProperty("version_minor","Version Minor",this._binary_data.charCodeAt(a+6));this.jfif._addProperty("version","JFIF Version",this.jfif.version_major.value+"."+this.jfif.version_minor.value);this.jfif._addProperty("units","Density Unit",this._binary_data.charCodeAt(a+7));this.jfif._addProperty("Xdensity","X density",b.parseNum(">",this._binary_data,a+8,2));this.jfif._addProperty("Ydensity","Y Density",b.parseNum(">",this._binary_data,a+10,2));this.jfif._addProperty("Xthumbnail","X Thumbnail",
b.parseNum(">",this._binary_data,a+12,1));this.jfif._addProperty("Ythumbnail","Y Thumbnail",b.parseNum(">",this._binary_data,a+13,1))};this.JpegMeta.JpegFile.prototype._app0Handler=function(c,a){this._binary_data.slice(a,a+5)==this._JFIF_IDENT&&this._jfifHandler(c,a)};this.JpegMeta.JpegFile.prototype._app1Handler=function(c,a){this._binary_data.slice(a,a+5)==this._EXIF_IDENT&&this._exifHandler(c,a+6)};b.JpegFile.prototype._exifHandler=function(c,a){if(void 0!==this.exif)throw Error("Multiple JFIF segments found");
var d,f;d=this._binary_data.slice(a,a+2);if("II"===d)d="<";else if("MM"===d)d=">";else throw Error("Malformed TIFF meta-data. Unknown endianess: "+d);f=b.parseNum(d,this._binary_data,a+2,2);if(42!==f)throw Error("Malformed TIFF meta-data. Bad magic: "+f);f=b.parseNum(d,this._binary_data,a+4,4);this._parseIfd(d,this._binary_data,a,f,this._tifftags,"tiff","TIFF");this.tiff.ExifIfdPointer&&this._parseIfd(d,this._binary_data,a,this.tiff.ExifIfdPointer.value,this._exiftags,"exif","Exif");this.tiff.GPSInfoIfdPointer&&
(this._parseIfd(d,this._binary_data,a,this.tiff.GPSInfoIfdPointer.value,this._gpstags,"gps","GPS"),this.gps.GPSLatitude&&(d=this.gps.GPSLatitude.value[0].asFloat()+1/60*this.gps.GPSLatitude.value[1].asFloat()+1/3600*this.gps.GPSLatitude.value[2].asFloat(),"S"===this.gps.GPSLatitudeRef.value&&(d=-d),this.gps._addProperty("latitude","Dec. Latitude",d)),this.gps.GPSLongitude&&(d=this.gps.GPSLongitude.value[0].asFloat()+1/60*this.gps.GPSLongitude.value[1].asFloat()+1/3600*this.gps.GPSLongitude.value[2].asFloat(),
"W"===this.gps.GPSLongitudeRef.value&&(d=-d),this.gps._addProperty("longitude","Dec. Longitude",d)))};return this.JpegMeta}();var debug_logging=!1,debug_canvas=!1,R=0,G=1,B=2,O=3,SnaprFX=function(b){return this.init(b)};window.SnaprFX=SnaprFX;SnaprFX.prototype.deferred=null;
SnaprFX.prototype.init=function(b){var c=this;c.deferred=new Deferred;c.options=b;c.render_options={editable:!1};c.handlers={};SnaprFX.utils.read_exif(c.options.url).done(function(a){c.exif=a;c.load_original(!0).done(function(){c.options.width=c.original.width;c.options.height=c.original.height;c.render_options.width=c.render_options.width||c.original.width;c.render_options.height=c.render_options.height||c.original.height;c.canvas=new SnaprFX.Canvas({width:c.original.width,height:c.original.height});
c.canvas.context.drawImage(c.original.canvas,0,0);c.update_element();setTimeout(function(){c.create_overlay_elements();c.deferred.resolve()},1)})});c.load_filter_pack=new Deferred;var a=new XMLHttpRequest;a.onload=function(){c.filter_pack=JSON.parse(a.response).filter_pack;c.filter_pack.base_path=c.options.filter_pack;c.load_filter_pack.resolve(c.filter_pack);c.load_fonts()};a.open("get",c.options.filter_pack+"filter-pack.json",!0);a.send();c.load_sticker_pack=new Deferred;var d=new XMLHttpRequest;
d.onload=function(){c.sticker_pack=JSON.parse(d.response).sticker_pack;c.sticker_pack.target_canvas||(c.sticker_pack.target_canvas={width:800,height:800});c.sticker_pack.by_slug={};c.sticker_pack.base_path=c.options.sticker_pack;c.sticker_pack.sections.forEach(function(a){a.stickers.forEach(function(a){c.sticker_pack.by_slug[a.slug]=a})});c.load_sticker_pack.resolve(c.sticker_pack)};d.open("get",c.options.sticker_pack+"sticker-pack.json",!0);d.send();c.current_filter="_original";c.filter_specs={_original:{name:"*Original*",
slug:"_original",layers:[]}};c.stickers=[];c.text=[]};SnaprFX.prototype.set_url=function(b,c){var a=this;this.options.url=b;var d=new Deferred;SnaprFX.utils.read_exif(a.options.url).done(function(c){a.exif=c;a.load_original(!0).done(function(){a.apply_filter({editable:a.render_options.editable});d.resolve()})});return d};
SnaprFX.prototype.set_options=function(b){var c=this.options.render_text,a;for(a in b)this.options[a]=b[a];!c&&this.options.render_text&&this.apply_filter({render_text:!0,editable:!1});!0===this.options.disable_text_edit?dom.addClass(this.elements.overlay,"fx-text-disabled"):dom.removeClass(this.elements.overlay,"fx-text-disabled");!0===this.options.disable_sticker_edit?dom.addClass(this.elements.overlay,"fx-stickers-disabled"):dom.removeClass(this.elements.overlay,"fx-stickers-disabled")};
SnaprFX.prototype.load_fonts=function(){var b=this;b.filter_pack.sections.forEach(function(c){c.filters.forEach(function(a){var c=b.filter_pack.base_path+"filters/"+a.slug+"/";b.load_filter(a.slug).done(function(){b.filter_specs[a.slug].fonts&&b.filter_specs[a.slug].fonts.forEach(function(a){var b;b="@font-face {"+("font-family: '"+a["font-family"]+"';");a["font-weight"]&&(b+="font-weight: "+a["font-weight"]+";");a["font-style"]&&(b+="font-style: "+a["font-style"]+";");a.eot&&(b+="src: url('"+c+"fonts/"+
a.eot+"');");b+="src:";a.eot&&(b+="url('"+c+"fonts/"+a.eot+"?#iefix') format('embedded-opentype'),");a.woff&&(b+="url('"+c+"fonts/"+a.woff+"') format('woff'),");a.ttf&&(b+="url('"+c+"fonts/"+a.ttf+"') format('truetype'),");a.svg&&(b+="url('"+c+"fonts/"+a.svg+"#"+a["font-family"]+"') format('svg');");b+="}";var g=document.createElement("style");g.type="text/css";g.styleSheet?g.styleSheet.cssText=b:g.appendChild(document.createTextNode(b));document.head.appendChild(g);b=document.createElement("span");
b.style["font-family"]=a["font-family"];document.body.appendChild(b)})})})})};SnaprFX.prototype.load_original=function(b){var c=this,a=new Deferred;c.original=new SnaprFX.Canvas({url:c.options.url,size:c.options.size,aspect:c.options.aspect,width:c.options.width,height:c.options.height,orientation:c.exif&&c.exif.orientation});c.original.deferred.done(function(){!1===b?a.resolve():c.render_stickers().done(function(){a.resolve()})});return a};
SnaprFX.prototype.update_element=function(){this.options.element.setAttribute("src",this.canvas.get_data_url())};
SnaprFX.prototype.apply_filter=function(b){var c=this;c.deferred=new Deferred;dom.addClass(document.body,"fx-processing");setTimeout(function(){function a(){var a=c.filter_specs[c.current_filter];a&&(a.layer_index=-1);if(c.render_options.region)debug_logging&&console.log("region",c.render_options.region),a=c.render_options.region,c.canvas.context.drawImage(c.original.canvas,a.left,a.top,a.width,a.height,a.left,a.top,a.width,a.height);else{var d=function(){c.canvas.context.drawImage(c.original.canvas,
0,0);var a=function(){c.pixels=c.canvas.get_data();c.apply_next_layer()};!b.editable||c.options.disable_sticker_edit?c.render_stickers().done(a):a()};c.original.set_size(c.render_options).done(function(){c.canvas.set_size({width:c.original.width,height:c.original.height}).done(d)})}}b=b||{};var d={filter:c.current_filter,editable:!1,width:c.options.width,height:c.options.height,size:c.options.size},f;for(f in d)f in b||(b[f]=d[f]);c.render_options=b;!b.editable&&!b.output&&c.deferred.done(function(){(!1!==
c.options.render_text||c.render_options.render_text)&&c.text.forEach(function(a){a.rerender()});c.stickers.forEach(function(a){a.rerender()})});if(b.filter!=c.current_filter){c.elements.old_text=[];d=c.elements.overlay.getElementsByClassName("fx-text");for(f=d.length-1;0<=f;f--)c.elements.old_text.push(d[f]);c.without_extras=null}debug_logging&&console.group(b.filter);(c.current_filter=b.filter)?b.filter in c.filter_specs?setTimeout(a,4):c.load_filter(b.filter).done(function(){setTimeout(a,4)}):setTimeout(a,
4)},4)};SnaprFX.prototype.load_filter=function(b){var c=this,a=new Deferred,d=new XMLHttpRequest;d.onload=function(){debug_logging&&console.log("loaded",b);c.filter_specs[b]=JSON.parse(d.response).filter;c.filter_specs[b].target_canvas||(c.filter_specs[b].target_canvas={width:800,height:800});a.resolve()};d.open("get",c.filter_pack.base_path+"filters/"+b+"/filter.json",!0);d.send();return a};
SnaprFX.prototype.output=function(b){var c=this,a=new Deferred;c.apply_filter({output:!0,width:b.width,height:b.height,size:b.size});c.deferred.done(function(){a.resolve(c.canvas.get_data_url())});return a};
SnaprFX.prototype.apply_next_layer=function(){var b=this,c=b.filter_specs[b.current_filter];c.layer_index++;if(c.layer_index>=c.layers.length)b.finish();else{debug_logging&&console.time("applying "+c.layers[c.layer_index].type+" layer");debug_logging&&console.log("applying",c.layers[c.layer_index].type,"layer");var a=c.layers[c.layer_index];a.filter?a.filter.update&&a.filter.update(a,b):a.filter=new SnaprFX.filters[a.type](a,b);a.blender=a.blender||new SnaprFX.Blender(a.blending_mode||"normal");a.filter.deferred.done(function(){function d(){for(var d=
b.render_options.region||{left:0,top:0,width:b.canvas.width,height:b.canvas.height},g,l=d.top;l<d.top+d.height;l+=1)for(var n=d.left;n<d.left+d.width;n+=1){g=4*(l*b.canvas.width+n);var m;m=a.filter.whole_canvas?[f.data[g],f.data[g+1],f.data[g+2],f.data[g+3]]:a.filter.process(g,[b.pixels.data[g],b.pixels.data[g+1],b.pixels.data[g+2]]);var p=m[O],p=0<=p?p/255:1;a.mask_image&&(p*=h.data[g]/255);p*=(a.opacity||100)/100;m=a.blender.process([b.pixels.data[g],b.pixels.data[g+1],b.pixels.data[g+2]],[m[R],
m[G],m[B]],p);b.pixels.data[g]=m[R];b.pixels.data[g+1]=m[G];b.pixels.data[g+2]=m[B]}debug_logging&&console.timeEnd("applying "+c.layers[c.layer_index].type+" layer");b.apply_next_layer()}var f;a.filter.whole_canvas&&(0!==c.layer_index&&b.canvas.put_data(b.pixels),a.filter.process(b.canvas),f=b.canvas.get_data());var h;if(a.mask_image){var g=new SnaprFX.Canvas({url:b.filter_pack.base_path+"filters/"+c.slug+"/"+a.mask_image,width:b.canvas.width,height:b.canvas.height});g.deferred.done(function(){h=
g.get_data();d()})}else d()})}};
SnaprFX.prototype.finish=function(){var b=this;debug_logging&&console.time("writing data back");b.elements.old_text&&b.elements.old_text.forEach(function(a){a.parentNode&&b.elements.overlay.removeChild(a)});b.canvas.put_data(b.pixels);b.render_options.output||b.update_element();b.deferred.resolve();dom.removeClass(document.body,"fx-processing");var c=b.stickers.length;if((!(!1!==b.options.render_text||b.render_options.render_text)&&!c||b.render_options.editable)&&!b.render_options.output)b.without_extras=b.canvas.clone();
debug_logging&&console.timeEnd("writing data back");debug_logging&&console.groupEnd(b.current_filter)};SnaprFX.prototype.unrender_editables=function(){this.options.disable_sticker_edit||this.stickers.forEach(function(b){b.unrender()});this.options.disable_text_edit||this.text.forEach(function(b){b.unrender()});this.without_extras?(this.canvas.context.drawImage(this.without_extras.canvas,0,0),this.update_element(),this.render_options.editable=!0):this.apply_filter({editable:!0})};
SnaprFX.prototype.rerender_editables=function(){this.apply_filter({editable:!1})};
SnaprFX.prototype.create_overlay_elements=function(){var b=this;b.elements={image:b.options.element};var c=b.elements.overlay=dom.div("fx-overlay-layer");dom.setStyle(c,{position:"absolute",top:0,left:0,height:"100%",width:"100%"});c.addEventListener("click",function(a){b.active_text&&b.active_text.deactivate();b.render_options.editable&&b.rerender_editables()});var a=b.elements.wrapper=dom.div("fx-wrapper");dom.setStyle(a,{position:"relative",height:b.options.height,width:b.options.width});b.elements.image.parentNode.insertBefore(a,
b.elements.image.nextSibling);a.appendChild(b.elements.image);a.appendChild(c);a=c.getBoundingClientRect();b.elements.overlay.offset_cache={left:a.left+window.pageXOffset,top:a.top+window.pageYOffset};debug_canvas&&dom.addClass(c,"fx-debug")};SnaprFX.prototype.on=function(b,c){this.handlers[b]||(this.handlers[b]=[]);this.handlers[b].push(c)};SnaprFX.prototype.trigger=function(b,c,a){this.handlers[b]&&this.handlers[b].forEach(function(b){b.call(c,a)})};"function"===typeof define&&define.amd&&define(function(){return SnaprFX});var dom={div:function(b){var c=document.createElement("div");c.className=b;return c},hasClass:function(b,c){return b.className.match(RegExp("(^|\\s)"+c+"(\\s|$)"))},addClass:function(b,c){dom.hasClass(b,c)||(b.className+=" "+c)},removeClass:function(b,c){b.className=b.className.replace(RegExp("(^|\\s)"+c+"(\\s|$)")," ")},setStyle:function(b,c){for(var a in c)b.style[a]=c[a]}};function Deferred(){this.callbacks=[]}
Deferred.prototype.resolve=function(b){this.resolved=!0;this.data=b;this.callbacks.forEach(function(c){c(b)});return this};Deferred.prototype.done=function(b){this.resolved?b(this.data):this.callbacks.push(b);return this};
SnaprFX.utils={compatible:function(){var b=document.createElement("canvas");return!(!b.getContext||!b.getContext("2d"))},rotated_dimensions:function(b,c,a){var d=Math.abs(Math.cos(a)*b)+Math.abs(Math.sin(a)*c);b=Math.abs(Math.sin(a)*b)+Math.abs(Math.cos(a)*c);return{width:d,height:b}},cart2polar:function(b,c){var a=Math.atan(c/b);0<c?0>b&&(a=Math.PI+a):a=0>b?Math.PI+a:2*Math.PI+a;return a},pythag:function(b,c){return Math.sqrt(Math.pow(b,2)+Math.pow(c,2))},preload_assets:function(b){var c=new XMLHttpRequest;
c.onload=function(){JSON.parse(c.response).filter_pack.sections.forEach(function(a){a.filters.forEach(function(a){var c=b.filter_pack+"filters/"+a.slug+"/",d=new XMLHttpRequest;d.onload=function(){var a=JSON.parse(d.response);a.filter.fonts&&a.filter.fonts.forEach(function(a){var b;b="@font-face {"+("font-family: '"+a["font-family"]+"';");a["font-weight"]&&(b+="font-weight: "+a["font-weight"]+";");a["font-style"]&&(b+="font-style: "+a["font-style"]+";");a.eot&&(b+="src: url('"+c+"fonts/"+a.eot+"');");
b+="src:";a.eot&&(b+="url('"+c+"fonts/"+a.eot+"?#iefix') format('embedded-opentype'),");a.woff&&(b+="url('"+c+"fonts/"+a.woff+"') format('woff'),");a.ttf&&(b+="url('"+c+"fonts/"+a.ttf+"') format('truetype'),");a.svg&&(b+="url('"+c+"fonts/"+a.svg+"#"+a["font-family"]+"') format('svg');");b+="}";var d=document.createElement("style");d.innerHTML=b;document.body.appendChild(d);b=document.createElement("span");b.style.fontFamily=a["font-family"];document.body.appendChild(b)});a.filter.layers.forEach(function(a){"image"==
a.type&&((new Image).src=c+a.image.image)})};d.open("get",c+"filter.json",!0);d.send()})})};c.open("get",b.filter_pack+"filter-pack.json",!0);c.send();var a=new XMLHttpRequest;a.onload=function(){JSON.parse(a.response).sticker_pack.sections.forEach(function(a){a.stickers.forEach(function(a){(new Image).src=b.sticker_pack+"assets/"+a.slug+".png"})})};a.open("get",b.sticker_pack+"sticker-pack.json",!0);a.send()},read_exif:function(b){var c=new Deferred,a=new XMLHttpRequest;a.open("GET",b,!0);a.responseType=
"arraybuffer";a.onload=function(b){var f=new FileReader;f.onloadend=function(){var b=new JpegMeta.JpegFile(this.result,"test.jpg");a=f=null;c.resolve({latitude:b.gps&&b.gps.latitude&&b.gps.latitude.value,longitude:b.gps&&b.gps.longitude&&b.gps.longitude.value,date:b.exif&&b.exif.DateTimeOriginal&&b.exif.DateTimeOriginal.value,orientation:b.tiff&&b.tiff.Orientation&&b.tiff.Orientation.value})};b=new Blob([this.response]);f.readAsBinaryString(b)};a.send();return c},rgbToHsl:function(b,c,a){b/=255;c/=
255;a/=255;var d=Math.max(b,c,a),f=Math.min(b,c,a),h,g=(d+f)/2;if(d==f)h=f=0;else{var e=d-f,f=0.5<g?e/(2-d-f):e/(d+f);switch(d){case b:h=(c-a)/e+(c<a?6:0);break;case c:h=(a-b)/e+2;break;case a:h=(b-c)/e+4}h/=6}return[h,f,g]},hslToRgb:function(b,c,a){if(0===c)a=c=b=a;else{var d=0.5>a?a*(1+c):a+c-a*c,f=2*a-d;a=SnaprFX.utils.hueToRgb(f,d,b+1/3);c=SnaprFX.utils.hueToRgb(f,d,b);b=SnaprFX.utils.hueToRgb(f,d,b-1/3)}return[255*a,255*c,255*b]},hueToRgb:function(b,c,a){0>a&&(a+=1);1<a&&(a-=1);return a<1/6?
b+6*(c-b)*a:0.5>a?c:a<2/3?b+6*(c-b)*(2/3-a):b}};SnaprFX.prototype.add_sticker=function(b){var c=this,a=new SnaprFX.sticker(b,c);c.stickers.push(a);a.deferred.done(function(){c.elements.overlay.appendChild(a.element);for(var b=c.elements.overlay.getElementsByClassName("fx-active"),f=0;f<b.length;f++)dom.removeClass(b[f],"fx-active");dom.addClass(a.element,"fx-active")});c.render_options.editable=!0};
SnaprFX.prototype.render_stickers=function(){function b(){var b=!0;c.stickers.forEach(function(a){if(!a.deferred.resolved)return b=!1});b&&a.resolve()}var c=this,a=new Deferred;c.original.deferred.done(function(){c.stickers.length||a.resolve();c.stickers.forEach(function(a){a.render(c.canvas).done(b)})});return a};
SnaprFX.sticker=function(b,c){var a=this;a.slug=b;a.parent=c;a.scale=1;a.rotation=0;a.spec=c.sticker_pack.by_slug[b];a.deferred=new Deferred;a.load().done(function(){a.scale_factor=Math.min(c.canvas.width/c.sticker_pack.target_canvas.width,c.canvas.height/c.sticker_pack.target_canvas.height);a.element=dom.div("fx-sticker fx-sticker-rendered");a.element.addEventListener("click",function(a){a.stopPropagation();c.active_text&&c.active_text.deactivate()});a.element.innerHTML='<img class="fx-sticker-image" src="'+
a.parent.sticker_pack.base_path+"assets/"+b+'.png">';var d={position:"absolute",width:a.image.width*a.scale_factor,height:a.image.height*a.scale_factor};a.spec.position&&a.spec.position.center?(d.left=a.spec.position.center.x*a.scale_factor-d.width/2,d.top=a.spec.position.center.y*a.scale_factor-d.height/2):(d.left=c.canvas.width/2-d.width/2,d.top=c.canvas.height/2-d.height/2);d.width+="px";d.height+="px";d.left+="px";d.top+="px";dom.setStyle(a.element,d);a.initial=d;a.rendered||dom.removeClass(a.element,
"fx-sticker-rendered");a.element.innerHTML+='<a class="fx-render-sticker fx-sticker-handle" data-role="button" data-icon="tick" data-iconpos="notext" data-theme="e">\u2714</a>';setTimeout(function(){a.element.getElementsByClassName("fx-render-sticker")[0].addEventListener("click",function(a){c.rerender_editables();a.stopPropagation()})},4);a.element.innerHTML+='<a class="dd fx-remove-sticker fx-sticker-handle" data-role="button" data-icon="delete" data-iconpos="notext" data-theme="e">\u2717</a>';
setTimeout(function(){a.element.getElementsByClassName("fx-remove-sticker")[0].addEventListener("click",function(){a.remove()})},4);a.element.addEventListener("mousedown",function(){if(!a.parent.options.disable_sticker_edit){a.rendered&&c.unrender_editables();for(var b=c.elements.overlay.getElementsByClassName("fx-active"),d=0;d<b.length;++d)dom.removeClass(b[d],"fx-active");dom.addClass(a.element,"fx-active");dom.removeClass(a.element,"fx-sticker-rendered")}});a.mousemove_drag=function(c){a.rendered||
dom.setStyle(a.element,{left:c.clientX-a.drag_from.left+"px",top:c.clientY-a.drag_from.top+"px"})};a.mouseup=function(){c.elements.wrapper.removeEventListener("mousemove",a.mousemove_drag);c.elements.wrapper.removeEventListener("mousemove",a.mousemove_scale)};c.elements.wrapper.addEventListener("mouseup",a.mouseup);a.element.addEventListener("mousedown",function(b){if(!a.rendered){var d=parseInt(a.element.style.left,10),g=parseInt(a.element.style.top,10);a.drag_from={left:b.clientX-d,top:b.clientY-
g,event:b};c.elements.wrapper.addEventListener("mousemove",a.mousemove_drag)}dom.addClass(c.elements.overlay,"fx-editing-sticker");dom.removeClass(c.elements.overlay,"fx-editing-text")});a.mousemove_scale=function(c){c.stopPropagation();if(!a.rendered){var b=SnaprFX.utils.pythag(c.clientX-a.scale_from.x,c.clientY-a.scale_from.y);a.scale=b/a.scale_from.size;a.scale=Math.max(a.scale,0.15);c=SnaprFX.utils.cart2polar(c.clientX-a.scale_from.x,c.clientY-a.scale_from.y);a.rotation=-a.scale_from.rotation+
c;c=parseInt(a.initial.width,10)*a.scale;b=parseInt(a.initial.height,10)*a.scale;dom.setStyle(a.element,{webkitTransform:"rotate("+Math.round(360*(a.rotation/(2*Math.PI)))+"deg)",transform:"rotate("+Math.round(360*(a.rotation/(2*Math.PI)))+"deg)",width:c+"px",height:b+"px",top:a.scale_from.y-b/2-a.parent.elements.overlay.offset_cache.top+"px",left:a.scale_from.x-c/2-a.parent.elements.overlay.offset_cache.left+"px"})}};a.element.innerHTML+='<a class="fx-scale-sticker fx-sticker-handle" data-role="button" data-icon="rotate" data-iconpos="notext" data-theme="e"> </a>';
setTimeout(function(){a.element.getElementsByClassName("fx-scale-sticker")[0].addEventListener("mousedown",function(b){b.stopPropagation();if(!a.rendered){var d=a.element.getElementsByClassName("fx-sticker-image")[0].getBoundingClientRect();a.scale_from={x:d.left+d.width/2-5,y:d.top+d.height/2-5,size:SnaprFX.utils.pythag(a.element.offsetHeight,a.element.offsetWidth)/2/a.scale,scale:a.scale};a.scale_from.rotation=SnaprFX.utils.cart2polar(b.clientX-a.scale_from.x,b.clientY-a.scale_from.y)-a.rotation;
c.elements.wrapper.addEventListener("mousemove",a.mousemove_scale)}})},4);a.element.addEventListener("dragstart",function(a){a.preventDefault()});a.deferred.resolve()})};SnaprFX.sticker.prototype.load=function(){var b=this;if(b.load_deferred)return b.load_deferred;b.load_deferred=new Deferred;b.image=new Image;b.image.src=b.parent.sticker_pack.base_path+"assets/"+b.slug+".png";b.image.onload=function(){b.load_deferred.resolve()};return b.load_deferred};
SnaprFX.sticker.prototype.render=function(b){var c=this;c.deferred=new Deferred;var a=c.element.getElementsByClassName("fx-sticker-image")[0],d=c.element.getElementsByClassName("fx-sticker-image")[0].getBoundingClientRect(),f=c.element.parentNode.getBoundingClientRect(),h=(d.left-f.left)/f.width,g=(d.top-f.top)/f.height,e=a.offsetWidth/f.width*b.width,k=a.offsetHeight/f.height*b.height,a=c.rotation,d=Math.PI;a>2*d&&(a-=2*d);0>a&&(a+=2*d);var f=Math.sin(a),l=Math.cos(a);a<d/2?h+=f*k/b.width:a>1.5*
d?g+=-f*e/b.height:a>d/2&&a<d?(h+=(f*k+-l*e)/b.width,g+=-l*k/b.height):(h+=-l*e/b.width,g+=(-l*k-f*e)/b.height);console.warn(h,g,h*b.width,g*b.height);c.load().done(function(){b.context.translate(h*b.width,g*b.height);b.context.rotate(c.rotation);b.context.drawImage(c.image,0,0,c.image.width,c.image.height,0,0,e,k);b.context.rotate(-c.rotation);b.context.translate(-h*b.width,-g*b.height);c.deferred.resolve()});return c.deferred};
SnaprFX.sticker.prototype.unrender=function(){this.rendered=!1;dom.removeClass(this.element,"fx-sticker-rendered")};SnaprFX.sticker.prototype.rerender=function(){this.rendered=!0;dom.addClass(this.element,"fx-sticker-rendered")};
SnaprFX.sticker.prototype.remove=function(){var b=this;b.parent.elements.overlay.removeChild(b.element);b.parent.elements.wrapper.removeEventListener("mousemove",b.mousemove);b.parent.elements.wrapper.removeEventListener("mouseup",b.mouseup);b.parent.stickers.forEach(function(c,a){c==b&&b.parent.stickers.splice(a,1)})};SnaprFX.sticker.prototype.get_dimensions=function(){return SnaprFX.utils.rotated_dimensions(this.element.offsetWidth,this.element.offsetHeight,-this.rotation)};SnaprFX.Canvas=function(b){var c=this;debug_logging&&console.log("canvas",b);c.options=b;c.deferred=new Deferred;c.canvas=document.createElement("canvas");c.context=c.canvas.getContext("2d");$&&debug_canvas&&($(document.body).append(c.canvas),$(c.canvas).css({border:"1px solid #f00",width:200}));if(b.url){debug_logging&&console.time("get image");switch(b.orientation){case 3:c.options.rotation=Math.PI;break;case 6:c.options.rotation=0.5*Math.PI;break;case 8:c.options.rotation=1.5*Math.PI;break;default:c.options.rotation=
0}c.image=new Image;c.image.src=b.url;c.image.onload=function(){c.place_image().done(function(){c.deferred.resolve()})}}else c.width=c.canvas.width=b.width,c.height=c.canvas.height=b.height,c.deferred.resolve()};
SnaprFX.Canvas.prototype.place_image=function(){var b=new Deferred;this.image.aspect=this.image.width/this.image.height;var c=0,a=0,d=this.image.width,f=this.image.height;if(this.options.size)if(this.options.aspect){var h;this.image.aspect>this.options.aspect?(this.height=this.canvas.height=this.options.size,this.width=this.canvas.width=this.height*this.options.aspect,h=this.image.width-this.image.height*this.options.aspect,c=h/2,d=this.image.width-h):(this.width=this.canvas.width=this.options.size,
this.height=this.canvas.height=this.width/this.options.aspect,h=this.image.height-this.image.width/this.options.aspect,a=h/2,f=this.image.height-h)}else 1<this.image.aspect?(this.width=this.canvas.width=this.options.size,this.height=this.canvas.height=this.width/this.image.aspect):(this.height=this.canvas.height=this.options.size,this.width=this.canvas.width=this.height*this.image.aspect);else this.width=this.canvas.width=this.options.width||this.image.width,this.height=this.canvas.height=this.options.height||
this.image.height;this.context.translate(this.canvas.width/2,this.canvas.height/2);this.context.rotate(this.options.rotation);this.context.drawImage(this.image,c,a,d,f,this.canvas.width/-2,this.canvas.height/-2,this.canvas.width,this.canvas.height);this.context.rotate(-this.options.rotation);this.context.translate(this.canvas.width/-2,this.canvas.height/-2);b.resolve();debug_logging&&console.timeEnd("get image");return b};
SnaprFX.Canvas.prototype.get_data=function(){return this.context.getImageData(0,0,this.canvas.width,this.canvas.height)};SnaprFX.Canvas.prototype.put_data=function(b){this.context.putImageData(b,0,0);return this};SnaprFX.Canvas.prototype.get_data_url=function(){return this.canvas.toDataURL("image/jpeg",1)};SnaprFX.Canvas.prototype.clear=function(){this.canvas.width=this.canvas.width};
SnaprFX.Canvas.prototype.set_size=function(b){b.width&&(this.canvas.width!=b.width&&(this.width=b.width,this.options.width=b.width,this.canvas.width=b.width),this.canvas.height!=b.height&&(this.height=b.height,this.options.height=b.height,this.canvas.height=b.height));this.options.size&&(this.options.size=b.size);return this.image?this.place_image():(new Deferred).resolve()};
SnaprFX.Canvas.prototype.clone=function(b){b=b||{};for(var c in this.options)c in b||(b[c]=this.options[c]);b=new SnaprFX.Canvas(b);b.context.drawImage(this.canvas,0,0);return b};SnaprFX.Blender=function(b){debug_logging&&console.log(" - Blend:",b);this.mode=this.blend_modes[b];this.process=this.mode.rgb?function(c,a,b){a=this.mode.process(c,a);for(var f=[],h=R;h<=B;h++)f[h]=a[h]*b+c[h]*(1-b);return f}:function(c,a,b){for(var f=[],h=R;h<=B;h++)f[h]=this.mode.process(c[h],a[h]),f[h]=f[h]*b+c[h]*(1-b);return f}};
SnaprFX.Blender.prototype.blend_modes={normal:{rgb:!1,process:function(b,c,a){return c}},multiply:{rgb:!1,process:function(b,c,a){return b*c/255}},screen:{rgb:!1,process:function(b,c,a){return 255-((255-c)*(255-b)>>8)}},overlay:{rgb:!1,process:function(b,c,a){return 128>b?b*c*(2/255):255-(255-b)*(255-c)*(2/255)}},darken:{rgb:!1,process:function(b,c,a){b<c&&(c=b);return c}},lighten:{rgb:!1,process:function(b,c,a){b>c&&(c=b);return c}},color_dodge:{rgb:!1,process:function(b,c,a){b=(b<<8)/(255-c);return 255<
b||255==c?255:b}},color_burn:{rgb:!1,process:function(b,c,a){b=255-(255-b<<8)/c;return 0>b||0===c?0:b}},soft_light:{rgb:!1,process:function(b,c,a){return 128>b?((c>>1)+64)*b*(2/255):255-(191-(c>>1))*(255-b)*(2/255)}},hard_light:{rgb:!1,process:function(b,c,a){return 128>c?b*c*(2/255):255-(255-b)*(255-c)*(2/255)}},difference:{rgb:!1,process:function(b,c,a){b-=c;return 0>b?-b:b}},exclusion:{rgb:!1,process:function(b,c,a){return b-(b*(2/255)-1)*c}},hue:{rgb:!0,process:function(b,c,a){return c}},saturation:{rgb:!0,
process:function(b,c,a){return c}},color:{rgb:!0,process:function(b,c,a){b=SnaprFX.utils.rgbToHsl(b[0],b[1],b[2]);c=SnaprFX.utils.rgbToHsl(c[0],c[1],c[2]);return SnaprFX.utils.hslToRgb(c[0],c[1],b[2])}},luminosity:{rgb:!0,process:function(b,c,a){return c}},subtract:{rgb:!1,process:function(b,c,a){c=b-c;0>c&&(c=0);return c}},add:{rgb:!1,process:function(b,c,a){c=b+c;255<c&&(c=255);return c}},divide:{rgb:!1,process:function(b,c,a){return 255*(b/c)}},linear_burn:{rgb:!1,process:function(b,c,a){return 255>
b+c?0:b+c-255}}};SnaprFX.filters={};SnaprFX.filters.adjustment=function(b){debug_logging&&console.log(" - Adjustment:",b.adjustment.type);this.filter=new SnaprFX.filters[b.adjustment.type](b);this.whole_canvas=this.filter.whole_canvas;this.process=this.filter.process;this.deferred=(new Deferred).resolve()};
SnaprFX.filters.curves=function(b){this.curves=b.adjustment;this.splines={};var c=this;["rgb","red","green","blue"].forEach(function(a){if(0===c.curves[a].length)c.splines[a]={interpolate:function(a){return a}};else{var b=[],f=[];c.curves[a].forEach(function(a){b.push(a[0]);f.push(a[1])});c.splines[a]=new c.CubicSpline(b,f)}})};
SnaprFX.filters.curves.prototype.process=function(b,c){c[0]=this.filter.splines.red.interpolate(c[0]);c[1]=this.filter.splines.green.interpolate(c[1]);c[2]=this.filter.splines.blue.interpolate(c[2]);c[0]=this.filter.splines.rgb.interpolate(c[0]);c[1]=this.filter.splines.rgb.interpolate(c[1]);c[2]=this.filter.splines.rgb.interpolate(c[2]);return c};
SnaprFX.filters.curves.prototype.CubicSpline=function(){function b(c,a){var b,f,h,g,e,k,l,n,m,p;if(null!==c&&null!==a){l=c.length-1;g=[];m=[];k=[];n=[];p=[];f=[];b=[];h=[];this.max_out=a[0];this.min_out=a[0];this.max_in=c[0];this.min_in=c[0];for(e=0;0<=l?e<l:e>l;0<=l?e+=1:e-=1)g[e]=c[e+1]-c[e],this.max_out=a[e+1]>this.max_out?a[e+1]:this.max_out,this.min_out=a[e+1]<this.min_out?a[e+1]:this.min_out,this.max_in=c[e+1]>this.max_in?c[e+1]:this.max_in,this.min_in=c[e+1]<this.min_in?c[e+1]:this.min_in;
for(e=1;1<=l?e<l:e>l;1<=l?e+=1:e-=1)m[e]=3/g[e]*(a[e+1]-a[e])-3/g[e-1]*(a[e]-a[e-1]);k[0]=1;n[0]=0;p[0]=0;for(e=1;1<=l?e<l:e>l;1<=l?e+=1:e-=1)k[e]=2*(c[e+1]-c[e-1])-g[e-1]*n[e-1],n[e]=g[e]/k[e],p[e]=(m[e]-g[e-1]*p[e-1])/k[e];k[l]=1;p[l]=0;f[l]=0;for(e=k=l-1;0>=k?0>=e:0<=e;0>=k?e+=1:e-=1)f[e]=p[e]-n[e]*f[e+1],b[e]=(a[e+1]-a[e])/g[e]-g[e]*(f[e+1]+2*f[e])/3,h[e]=(f[e+1]-f[e])/(3*g[e]);this.x=c.slice(0,l+1);this.a=a.slice(0,l);this.b=b;this.c=f.slice(0,l);this.d=h}}b.prototype.derivative=function(){var c,
a,b,f,h;a=new this.constructor;a.x=this.x.slice(0,this.x.length);a.a=this.b.slice(0,this.b.length);h=this.c;b=0;for(f=h.length;b<f;b++)c=h[b],a.b=2*c;h=this.d;b=0;for(f=h.length;b<f;b++)c=h[b],a.c=3*c;c=0;for(b=this.d.length;0<=b?c<b:c>b;0<=b?c+=1:c-=1)a.d=0;return a};b.prototype.interpolate=function(b){if(b>=this.max_in)return this.max_out;if(b<=this.min_in)return this.min_out;var a,d;for(a=d=this.x.length-1;(0>=d?0>=a:0<=a)&&!(this.x[a]<=b);0>=d?a+=1:a-=1);b-=this.x[a];return this.a[a]+this.b[a]*
b+this.c[a]*Math.pow(b,2)+this.d[a]*Math.pow(b,3)};return b}();SnaprFX.filters.levels=function(b){var c=b.adjustment;this.interpolate=function(a){var b=c.white-c.black;return Math.pow((a-c.black)/b,1/c.mid)*b/(b/255)}};SnaprFX.filters.levels.prototype.process=function(b,c){c[R]=this.filter.interpolate(c[R]);c[G]=this.filter.interpolate(c[G]);c[B]=this.filter.interpolate(c[B]);return c};SnaprFX.filters.hue=function(b){this.hue=b.adjustment.amount};
SnaprFX.filters.hue.prototype.process=function(b,c){var a=SnaprFX.utils.rgbToHsl(c[R],c[G],c[B]);a[0]+=this.filter.hue/255;1<a[0]&&(a[0]-=1);0>a[0]&&(a[0]+=1);return SnaprFX.utils.hslToRgb(a[0],a[1],a[2])};SnaprFX.filters.saturation=function(b){this.saturation=b.adjustment.amount/100};
SnaprFX.filters.saturation.prototype.process=function(b,c){var a=SnaprFX.utils.rgbToHsl(c[R],c[G],c[B]),d;d=0>this.filter.saturation?a[1]*(this.filter.saturation+1):a[1]*(2*this.filter.saturation+1);d=Math.min(255,d);return SnaprFX.utils.hslToRgb(a[0],d,a[2])};SnaprFX.filters.lightness=function(b){this.lightness=b.adjustment.amount/100};
SnaprFX.filters.lightness.prototype.process=function(b,c){var a=this.filter.lightness,d=0>a?1+a:1-a,a=0>a?0:255*a;return[Math.min(c[R]*d+a,255),Math.min(c[G]*d+a,255),Math.min(c[B]*d+a,255)]};SnaprFX.filters.remap_channels=function(b){this.channels=b.adjustment;this.blender=new SnaprFX.Blender("lighten")};
SnaprFX.filters.remap_channels.prototype.process=function(b,c){var a=this.filter,d=a.channels.base||c,d=a.blender.process(d,a.channels.b,c[B]/255),d=a.blender.process(d,a.channels.g,c[G]/255);return d=a.blender.process(d,a.channels.r,c[R]/255)};SnaprFX.filters.blur=function(b){this.whole_canvas=!0;this.amount=Math.max(0,Math.min(5,b.adjustment.amount))};
SnaprFX.filters.blur.prototype.process=function(b){var c=Math.round(b.width/2),a=Math.round(b.height/2),d=document.createElement("canvas");d.width=c;d.height=a;for(var f=Math.round(20*this.filter.amount),h=d.getContext("2d"),g=0;g<f;g++){var e=Math.max(1,Math.round(c-g)),k=Math.max(1,Math.round(a-g));h.clearRect(0,0,c,a);h.drawImage(b.canvas,0,0,b.width,b.height,0,0,e,k);b.context.drawImage(d,0,0,e,k,0,0,b.width,b.height)}};SnaprFX.filters.color=function(b){this.color=b.color.rgb;this.deferred=(new Deferred).resolve()};
SnaprFX.filters.color.prototype.process=function(b,c){return this.color};SnaprFX.filters.image=function(b,c){var a=this;a.url=b.image.image;a.width=c.canvas.width;a.height=c.canvas.height;a.canvas=new SnaprFX.Canvas({url:c.filter_pack.base_path+"filters/"+c.current_filter+"/"+a.url,width:a.width,height:a.height});a.deferred=new Deferred;a.canvas.deferred.done(function(){a.pixels=a.canvas.get_data();a.deferred.resolve()})};
SnaprFX.filters.image.prototype.update=function(b,c){var a=this;a.width=c.canvas.width;a.height=c.canvas.height;a.deferred=new Deferred;a.canvas.set_size({width:a.width,height:a.height}).done(function(){a.pixels=a.canvas.get_data();a.deferred.resolve()})};SnaprFX.filters.image.prototype.process=function(b,c){return[this.pixels.data[b],this.pixels.data[b+1],this.pixels.data[b+2],this.pixels.data[b+3]]};var debug_borders=!1;SnaprFX.prototype.add_text=function(b){b.filter=new SnaprFX.filters.text(b,this);this.filter_specs[this.current_filter].layers.push(b)};SnaprFX.filters.text=function(b,c){this.parent=c;c.text.push(this);b.slug||(b.slug="layer-"+c.text.length);this.slug=b.slug;this.text_style=b.text.style;this.text=c.options.text&&c.options.text[b.slug]||b.text.default_value;this.canvas=new SnaprFX.Canvas({width:c.canvas.width,height:c.canvas.height});this.update(b,c)};
SnaprFX.filters.text.prototype.calculate_position=function(b,c){c.filter_specs[c.current_filter].target_canvas?(this.x_scale_factor=this.canvas.width/c.filter_specs[c.current_filter].target_canvas.width,this.y_scale_factor=this.canvas.height/c.filter_specs[c.current_filter].target_canvas.height):this.x_scale_factor=this.y_scale_factor=1;this.position=b.position&&b.position.bbox?{top:b.position.bbox.top*this.y_scale_factor,bottom:b.position.bbox.bottom*this.y_scale_factor,left:b.position.bbox.left*
this.x_scale_factor,right:b.position.bbox.right*this.x_scale_factor}:{top:0,bottom:this.canvas.height,left:0,right:this.canvas.width};b.position&&(this.position.x=b.position.x*this.x_scale_factor,this.position.y=b.position.y*this.y_scale_factor);this.bbox={top:this.position.top,bottom:this.position.bottom,left:this.position.left,right:this.position.right}};
SnaprFX.filters.text.prototype.set_canvas_font=function(){var b=this.text_element.style.fontSize,c=this.text_element.style.lineHeight;this.text_element.style.fontSize=parseInt(this.text_element.style.fontSize,10)*this.render_scale+"px";this.text_element.style.lineHeight=parseInt(this.text_element.style.lineHeight,10)*this.render_scale+"px";this.canvas.context.font=this.text_element.style.font;this.text_element.style.fontSize=b;this.text_element.style.lineHeight=c};
SnaprFX.filters.text.prototype.update=function(b,c){var a=this;a.rendered=(!1!==c.options.render_text||c.render_options.render_text||c.render_options.output)&&(!c.render_options.editable||c.options.disable_text_edit);a.spec=b;a.draggable=b.position&&b.position.draggable;a.deferred=new Deferred;a.canvas.set_size({height:c.canvas.width,width:c.canvas.height}).done(function(){function d(b,c){for(var d=b.split("\n"),f=[],h=0,e=0;e<d.length;e++){var g=d[e].split(" ");f[h]=g[0];for(var k=1;k<g.length;k++)g[k]&&
(a.canvas.context.measureText(f[h]+" "+g[k]).width>c?(h++,f[h]=g[k]):f[h]=f[h]+" "+g[k]);h++}return f}a.canvas.clear();a.calculate_position(b,c);a.create_overlay(b,c);a.text=a.text_element.innerText;a.text_element.innerHTML=a.text.replace(/\n/g,"<br>");a.text_style.fillStyle=a.text_element.style.color;a.text_style.textAlign=a.element.style.textAlign;a.render_scale=a.canvas.height/c.elements.overlay.offsetHeight;a.set_canvas_font();a.canvas.context.textAlign=a.text_style.textAlign||"left";a.canvas.context.textBaseline=
a.text_style.textBaseline||"top";a.canvas.context.fillStyle=a.text_style.fillStyle;a.text_style.fontSize=parseInt(a.text_element.style.fontSize,10);a.text_style.lineHeight=parseInt(a.text_element.style.lineHeight,10);var f=a.element.getBoundingClientRect(),h=c.elements.overlay.getBoundingClientRect();a.position.left=parseInt(f.left,10)-parseInt(h.left,10);a.position.top=parseInt(f.top,10)-parseInt(h.top,10);a.position.right=a.position.left+parseInt(f.width,10);a.position.bottom=a.position.top+parseInt(f.height,
10);var f=a.position.right-a.position.left,g=Math.round(a.position.bottom-a.position.top);console.log(a.text);for(var h=d(a.text,f),e=1E3;e&&(!h||(h.length-1)*a.text_style.lineHeight+a.text_style.fontSize>g);)e--,a.text_style.fontSize*=0.8,a.text_element.style.fontSize=a.text_style.fontSize+"px",a.text_style.lineHeight*=0.8,a.text_element.style.lineHeight=a.text_style.lineHeight+"px",a.set_canvas_font(),h=d(a.text,f);e||console.warn("render shrunk text 1000 times without success!");switch(a.text_style.textAlign){case "end":case "right":e=
a.position.right;break;case "center":e=f/2+a.position.left;break;default:e=a.position.left}e*=a.render_scale;switch(a.text_style.textBaseline){case "alphabetic":case "ideographic":case "bottom":g=a.position.bottom-a.text_style.lineHeight*(h.length-1);break;case "middle":g=g/2+a.position.top-a.text_style.lineHeight*(h.length-1)/2;break;default:g=a.position.top}g*=a.render_scale;if(a.slug!==c.render_options.active_text&&!b.removed)for(var k=0;k<h.length;k++)debug_borders&&(a.canvas.context.strokeStyle=
"#ff0000",a.canvas.context.strokeRect(e,g+k*a.text_style.lineHeight*a.render_scale,f*a.render_scale,a.text_style.lineHeight*a.render_scale)),debug_logging&&console.log("drawing text",h[k],e,g+k*a.text_style.lineHeight*a.render_scale,f*a.render_scale),a.canvas.context.fillText(h[k],e,g+k*a.text_style.lineHeight*a.render_scale,f*a.render_scale);a.pixels=a.canvas.get_data();a.deferred.resolve()})};
SnaprFX.filters.text.prototype.create_overlay=function(b,c){var a=this;if(!a.element||!a.element.parentNode){a.overlay=c.elements.overlay;var d={position:"absolute",left:a.position.left+"px",top:a.position.top+"px",width:a.position.right-a.position.left+"px",height:a.position.bottom-a.position.top+"px","text-align":a.text_style.textAlign};if(a.position.x)switch(a.text_style.textAlign){case "end":case "right":d.width=a.position.x+"px";break;case "center":a.position.right-a.position.x<a.position.x-
a.position.left?(d.width=2*(a.position.right-a.position.x)+"px",d.left=a.position.right-d.width+"px"):d.width=2*(a.position.x-a.position.left)+"px";break;default:d.left=a.position.x+"px",d.width=a.position.right-a.position.x+"px"}if(a.position.y)switch(a.text_style.textBaseline){case "hanging":case "alphabetic":case "ideographic":case "bottom":d.height=a.position.y;break;case "middle":a.position.bottom-a.position.y<a.position.y-a.position.top?(d.height=2*(a.position.bottom-a.position.y),d.top=a.position.bottom-
d.height+"px"):d.height=2*(a.position.y-a.position.top);break;default:d.height=a.bbox.bottom-a.position.y,d.top=a.position.y+"px"}d.lineHeight=d.height;a.element=dom.div("fx-text");dom.setStyle(a.element,d);a.rendered&&(!1!==c.options.render_text||c.render_options.render_text)&&dom.addClass(a.element,"fx-text-rendered");a.wrapper=dom.div("fx-text-wrapper");dom.setStyle(a.wrapper,{lineHeight:"normal","vertical-align":a.text_style.textBaseline});a.wrapper.addEventListener("click",function(a){a.stopPropagation()});
a.text_element=dom.div("fx-text-inner");a.text_element.setAttribute("data-layer",a.slug);dom.setStyle(a.text_element,{font:a.text_style.font,color:a.text_style.fillStyle});a.text_element.innerText=a.text;a.text_element.addEventListener("mousedown",function(){if(!c.options.disable_text_edit){for(var d=dom.hasClass(a.element,"fx-active"),h=dom.hasClass(a.element,"fx-text-rendered"),g=a.overlay.getElementsByClassName("fx-active"),e=[],k=0;k<g.length;++k)g[k]!==a.element&&e.push(g[k]);e.length&&(a.deactivate(e),
c.active_text=null);d||(dom.addClass(a.element,"fx-active"),dom.removeClass(a.element,"fx-text-rendered"),c.trigger("activate_text",a.element,b),c.active_text=a);dom.addClass(c.elements.overlay," fx-editing-text");dom.removeClass(c.elements.overlay,"fx-editing-sticker");h&&c.unrender_editables()}});a.text_element.addEventListener("dblclick",function(){a.editable=!0;dom.addClass(a.element,"fx-editable");a.text_element.setAttribute("contenteditable",!0);a.text_element.focus();var b,c;document.createRange?
(b=document.createRange(),b.selectNodeContents(a.text_element),b.collapse(!1),c=window.getSelection(),c.removeAllRanges(),c.addRange(b)):document.selection&&(b=document.body.createTextRange(),b.moveToElementText(a.text_element),b.collapse(!1),b.select())});a.text_element.addEventListener("keyup",function(){a.check_size()});a.element.appendChild(a.wrapper);a.wrapper.appendChild(a.text_element);d=document.createElement("a");d.className="fx-delete-layer fx-text-button";d.innerText="\u2717";dom.setStyle(d,
{position:"absolute",top:0,left:0});d.addEventListener("click",function(){a.remove()});a.wrapper.appendChild(d);d=document.createElement("a");d.className="fx-render-layer fx-text-button";d.innerText="\u2714";dom.setStyle(d,{position:"absolute",top:0,right:0});d.addEventListener("click",function(){!1!==c.options.render_text||c.render_options.render_text?c.rerender_editables():a.deactivate()});a.wrapper.appendChild(d);a.draggable&&(a.mousemove_drag=function(b){if(!a.rendered&&!a.editable){var c={},
d,e=a.bbox.right-a.bbox.left;switch(a.text_style.textAlign){case "end":case "right":c.width=Math.min(b.pageX+a.drag_from.right-a.bbox.left,e);break;case "center":d=(a.drag_from.right-a.drag_from.left)/2;d=b.pageX+d+a.bbox.left;c.width=2*(d-a.bbox.left-a.bbox.left);c.width>e&&(c.left=a.bbox.left+(c.width-e),c.left=Math.min(c.left,a.bbox.left+e),c.width=e-(c.left-a.bbox.left));break;default:c.left=Math.max(a.bbox.left,b.pageX-a.drag_from.left),c.width=a.bbox.right-c.left}e=a.bbox.bottom-a.bbox.top;
d=a.text_element.offsetHeight-18;switch(a.text_style.textBaseline){case "hanging":case "alphabetic":case "ideographic":case "bottom":c.height=Math.min(b.pageY+a.drag_from.bottom-a.bbox.top,e);break;case "middle":d=(a.drag_from.bottom-a.drag_from.top)/2;d=b.pageY+d+a.bbox.top;c.height=2*(d-a.bbox.top-a.bbox.top);c.height>e&&(c.top=a.bbox.top+(c.height-e),c.top=Math.min(c.top,a.bbox.top+e-a.text_style.lineHeight),c.height=e-(c.top-a.bbox.top));break;default:c.top=Math.min(a.bbox.bottom-d,b.pageY-a.drag_from.top),
c.top=Math.max(a.bbox.top,c.top),c.height=a.bbox.bottom-c.top}c.height=Math.max(c.height,a.text_style.lineHeight);c.lineHeight=c.height+"px";c.height+="px";c.width+="px";c.top+="px";c.left+="px";dom.setStyle(a.element,c)}},a.mouseup=function(){c.elements.wrapper.removeEventListener("mousemove",a.mousemove_drag)},c.elements.wrapper.addEventListener("mouseup",a.mouseup),a.element.addEventListener("mousedown",function(b){if(!a.rendered){var d=parseInt(a.element.style.left,10),g=parseInt(a.element.style.top,
10),e=parseInt(a.element.style.width,10),k=parseInt(a.element.style.height,10);a.drag_from={left:b.pageX-d,right:d+e-b.pageX,top:b.pageY-g,bottom:g+k-b.pageY,event:b};c.elements.wrapper.addEventListener("mousemove",a.mousemove_drag)}dom.addClass(c.elements.overlay,"fx-editing-text");dom.removeClass(c.elements.overlay,"fx-editing-sticker")}));a.text_style.fontSize=parseInt(a.text_element.style.fontSize,10)*a.y_scale_factor;a.text_element.style.fontSize=a.text_style.fontSize+"px";a.text_style.lineHeight=
a.text_element.style.lineHeight;"%"==a.text_style.lineHeight.substr(-1)?a.text_style.lineHeight=parseInt(a.text_style.lineHeight,10)/100*a.text_style.fontSize:a.text_style.lineHeight=parseInt(a.text_style.lineHeight,10)*a.y_scale_factor;a.text_element.style.lineHeight=a.text_style.lineHeight+"px";a.text_element.setAttribute("data-lineHeight-multiplier",a.text_style.lineHeight/a.text_style.fontSize);a.overlay.appendChild(a.element);a.check_size()}};
SnaprFX.filters.text.prototype.change_style=function(b){dom.setStyle(this.text_element,b);"text-align"in b&&(this.element.style.textAlign=b["text-align"]);this.check_size()};
SnaprFX.filters.text.prototype.check_size=function(b){this.text_style.fontSize=parseInt(this.text_element.style.fontSize,10);this.text_style.lineHeight=parseInt(this.text_element.style.lineHeight,10);b=window.getComputedStyle(this.text_element,null);for(var c=1E3;c&&(parseInt(b.width,10)>this.element.offsetWidth||parseInt(b.height,10)>Math.round(this.element.offsetHeight));)c--,this.text_style.fontSize*=0.99,this.text_element.style.fontSize=this.text_style.fontSize+"px",this.text_style.lineHeight*=
0.99,this.text_element.style.lineHeight=this.text_style.lineHeight+"px";c||console.warn("check_size shrunk text 1000 times without success!")};SnaprFX.filters.text.prototype.remove=function(){this.element.style.display="none";this.spec.removed=!0};SnaprFX.filters.text.prototype.unrender=function(){dom.removeClass(this.element,"fx-text-rendered");this.rendered=!1};SnaprFX.filters.text.prototype.rerender=function(){dom.addClass(this.element,"fx-text-rendered");this.rendered=!0};
SnaprFX.filters.text.prototype.deactivate=function(b){function c(b){dom.removeClass(b,"fx-active");var c=b.getElementsByClassName("fx-text-inner")[0];c&&(dom.removeClass(b,"fx-editable"),a.parent.trigger("deactivate_text",a.element),c.setAttribute("contenteditable",!1))}var a=this;if(b)for(var d=0;d<b.length;++d)c(b[d]);else c(a.element);a.editable=!1};
SnaprFX.filters.text.prototype.process=function(b,c){return!this.rendered?[0,0,0,0]:[this.pixels.data[b],this.pixels.data[b+1],this.pixels.data[b+2],this.pixels.data[b+3]]};var css=".fx-active-border{margin:-2px;border:solid rgba(240,240,240,.8) 2px;border-radius:4px;box-shadow:0 0 3px rgba(0,0,0,.3)}.fx-text{text-transform:none;pointer-events:none}.fx-text.fx-text-rendered{opacity:0}.fx-text .fx-text-wrapper{pointer-events:auto;position:relative;display:inline-block;margin:-9px}.fx-text .fx-text-inner{user-select:none;-webkit-user-select:none;-moz-user-select:none;padding:9px;outline:0;display:inline-block}.fx-text.fx-editable .fx-text-inner{user-select:text;-webkit-user-select:text;-moz-user-select:text;background-color:rgba(255,255,255,.2)}.fx-text .fx-text-button{display:none}.fx-text .fx-text-edit-note{display:none;background:#fff;color:#000;position:absolute;height:12px;top:0;left:10%;right:10%}.fx-text .fx-text-edit-note .fx-text-edit-note-not-editing{display:block}.fx-text .fx-text-edit-note .fx-text-edit-note-editing{display:none}.fx-text.fx-editable .fx-text-edit-note-not-editing{display:none}.fx-text.fx-editable .fx-text-edit-note-editing{display:block}.fx-text.fx-active .fx-text-edit-note{display:block}.fx-text.fx-active .fx-text-inner{margin:-2px;border:solid rgba(240,240,240,.8) 2px;border-radius:4px;box-shadow:0 0 3px rgba(0,0,0,.3)}.fx-text.fx-active .fx-text-button{display:block}.fx-sticker{padding:.5em;-webkit-user-select:none;opacity:1;transition:0}.fx-sticker .fx-sticker-image{width:100%;height:100%}.fx-sticker.fx-sticker-rendered{opacity:0;transition:opacity .4s linear}.fx-sticker .fx-sticker-handle{display:none}.fx-sticker.fx-active{margin:-2px;border:solid rgba(240,240,240,.8) 2px;border-radius:4px;box-shadow:0 0 3px rgba(0,0,0,.3)}.fx-sticker.fx-active .fx-sticker-handle{display:block}.fx-sticker .fx-remove-sticker{top:0;left:0;background:#000;color:#fff}.fx-sticker .fx-render-sticker{top:0;right:0}.fx-sticker .fx-scale-sticker{bottom:0;right:0;font-weight:700}.fx-text-disabled .fx-text{pointer-events:none}.fx-stickers-disabled .fx-sticker{pointer-events:none}.fx-editing-text .fx-text{z-index:2}.fx-editing-text .fx-text.fx-active{z-index:3}.fx-editing-sticker .fx-sticker{z-index:2}.fx-editing-sticker .fx-sticker.fx-active{z-index:3}.fx-text-button,.fx-sticker-handle{background-color:#ff0;padding:4px;display:block;min-width:12px;min-height:12px;border-radius:20px;border:#fff solid 2px;font-size:12px;line-height:12px;text-align:center;color:#000;margin:-12px;box-shadow:0 0 3px rgba(0,0,0,.3);cursor:pointer;position:absolute}.fx-delete-layer{background-color:#000;color:#fff}.fx-debug .fx-text{border:1px solid #090}.fx-debug .fx-text .fx-text-wrapper{border:1px dashed #009}.fx-debug .fx-text .fx-text-inner{border:1px dotted #900}",
htmlDiv=document.createElement("div");htmlDiv.innerHTML="<p>x</p><style>"+css+"</style>";document.getElementsByTagName("head")[0].appendChild(htmlDiv.childNodes[1]);
